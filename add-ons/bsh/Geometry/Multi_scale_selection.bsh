// Multi_scale_selection.bsh --- -*- coding: iso-8859-1 -*-
// July 8, 2006 - jPicEdt 1.4, a picture editor for LaTeX.
// Copyright (C) 1999/2006 Sylvain Reynal
//
// Author: Sylvain Reynal
//         Département de Physique
//         École Nationale Supérieure de l'Électronique et de ses Applications (ÉNSÉA)
//         6, avenue du Ponceau
//         95014 CERGY CEDEX
//         FRANCE
//
//         Tel : +33 130 736 245
//         Fax : +33 130 736 667
//         e-mail : reynal@ensea.fr
//
// Version: $Id: Multi_scale_selection.bsh,v 1.3 2012/08/19 09:23:48 vincentb1 Exp $
// Keywords:
// X-URL: http://www.jpicedt.org/
//
// Ce logiciel est régi par la licence CeCILL soumise au droit français et
// respectant les principes de diffusion des logiciels libres. Vous pouvez
// utiliser, modifier et/ou redistribuer ce programme sous les conditions
// de la licence CeCILL telle que diffusée par le CEA, le CNRS et l'INRIA
// sur le site "http://www.cecill.info".
//
// En contrepartie de l'accessibilité au code source et des droits de copie,
// de modification et de redistribution accordés par cette licence, il n'est
// offert aux utilisateurs qu'une garantie limitée.  Pour les mêmes raisons,
// seule une responsabilité restreinte pèse sur l'auteur du programme,  le
// titulaire des droits patrimoniaux et les concédants successifs.
//
// A cet égard  l'attention de l'utilisateur est attirée sur les risques
// associés au chargement,  à l'utilisation,  à la modification et/ou au
// développement et à la reproduction du logiciel par l'utilisateur étant
// donné sa spécificité de logiciel libre, qui peut le rendre complexe à
// manipuler et qui le réserve donc à des développeurs et des professionnels
// avertis possédant  des  connaissances  informatiques approfondies.  Les
// utilisateurs sont donc invités à charger  et  tester  l'adéquation  du
// logiciel à leurs besoins dans des conditions permettant d'assurer la
// sécurité de leurs systèmes et ou de leurs données et, plus généralement,
// à l'utiliser et l'exploiter dans les mêmes conditions de sécurité.
//
// Le fait que vous puissiez accéder à cet en-tête signifie que vous avez
// pris connaissance de la licence CeCILL, et que vous en avez accepté les
// termes.
//
/// Commentary:

// This BeanShell script copies the selection a given number of times,
// scaling each pasted element by (i*sx,i*sy) wrt (x,y)

/// Code:
import jpicedt.graphic.PicPoint;
import jpicedt.graphic.model.Element;
import jpicedt.widgets.*;

import java.util.ArrayList;

setStrictJava(true);

String scriptTitle = "Repeat scale BSH";

if (canvas()==null) {
	mdimgr.showMessageDialog("First open a board and select an object !",scriptTitle,JOptionPane.ERROR_MESSAGE);
	return;
}

SelectionHandler sel = editorkit().getSelectionHandler();

if (sel.isEmpty()) {
	mdimgr.showMessageDialog("First select objects to be copied!",scriptTitle,JOptionPane.ERROR_MESSAGE);
	return;
}

void proceed(){
	int repeat = repeatTF.getValue();
	if(repeat <= 0)
		return;
	double x    = scalingPtXTF.getValue();
	double y    = scalingPtYTF.getValue();
	PicPoint pt= new PicPoint(x,y);
	double sx   = scalingFactorXTF.getValue();
	double sy   = scalingFactorYTF.getValue();

	ArrayList addedElements = new ArrayList();
	for (int i = 1; i <= repeat; i++){
		for(Element e : sel){
			Element scaled = e.clone();
			scaled.scale(pt,i*sx,i*sy);
			addedElements.add(scaled);
		}
	}
	drawing().addAll(addedElements);
}


// create user pane :
JPanel box = new JPanel(new GridLayout(6,2,5,5));
box.add(new JLabel("Repeat Count:"));
WholeNumberField repeatTF=new WholeNumberField(1,10); box.add(repeatTF);
box.add(new JLabel("Scaling point x-coordinate:"));
DecimalNumberField scalingPtXTF=new DecimalNumberField(0,10,false); box.add(scalingPtXTF);
box.add(new JLabel("Scaling point y-coordinate:"));
DecimalNumberField scalingPtYTF=new DecimalNumberField(0,10,false); box.add(scalingPtYTF);
box.add(new JLabel("Scaling factor X:"));
DecimalNumberField scalingFactorXTF=new DecimalNumberField(0,10,false); box.add(scalingFactorXTF);
box.add(new JLabel("Scaling factor Y:"));
DecimalNumberField scalingFactorYTF=new DecimalNumberField(0,10,false); box.add(scalingFactorYTF);

JButton butOk = new JButton(Localizer.localize("button.OK"));
box.add(butOk);
butOk.addActionListener(new ActionListener(){
		void actionPerformed(ActionEvent e){
			proceed();
			jf.dispose();
		}
});

JButton butCancel = new JButton(Localizer.localize("button.Cancel"));
box.add(butCancel);
butCancel.addActionListener(new ActionListener(){
		void actionPerformed(ActionEvent e){
			jf.dispose();
		}
});

boolean modal = true;
MDIComponent jf = mdimgr.createDialog(scriptTitle + "\u2026", modal, box);
jf.setVisible(true);

